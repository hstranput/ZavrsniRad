<h2>Admin Kontrolna Ploča</h2>
<hr>

<div class="row">
  <div class="col-md-6 col-lg-3 mb-4" *ngIf="occupancy$ | async as occupancyData">
    <div class="card text-white bg-primary h-100">
      <div class="card-body">
        <h5 class="card-title">Korisnika u teretani</h5>
        <p class="card-text display-4">{{ occupancyData.occupancy }}</p>
      </div>
    </div>
  </div>

  <ng-container *ngIf="sensorData$ | async as sensorData">
    <div class="col-md-6 col-lg-3 mb-4" *ngIf="sensorData.sensor1">
      <div class="card h-100">
        <div class="card-header">Senzor 1</div>
        <div class="card-body">
          <p class="card-text fs-5">
            Temperatura: <strong>{{ sensorData.sensor1.temperatura | number:'1.1-1' }} °C</strong>
          </p>
          <p class="card-text fs-5">
            Tlak: <strong>{{ sensorData.sensor1.tlak | number:'1.0-0' }} hPa</strong>
          </p>
        </div>
        <div class="card-footer text-muted">
          Zadnje očitanje: {{ sensorData.sensor1.timestamp | date:'medium' }}
        </div>
      </div>
    </div>

    <div class="col-md-6 col-lg-3 mb-4" *ngIf="sensorData.sensor2">
      <div class="card h-100">
        <div class="card-header">Senzor 2</div>
        <div class="card-body">
          <p class="card-text fs-5">
            Temperatura: <strong>{{ sensorData.sensor2.temperatura | number:'1.1-1' }} °C</strong>
          </p>
          <p class="card-text fs-5">
            Tlak: <strong>{{ sensorData.sensor2.tlak | number:'1.0-0' }} hPa</strong>
          </p>
        </div>
        <div class="card-footer text-muted">
          Zadnje očitanje: {{ sensorData.sensor2.timestamp | date:'medium' }}
        </div>
      </div>
    </div>
  </ng-container>
</div>

<hr class="my-4">

<div class="d-flex justify-content-between align-items-center mb-3">
  <h4>Administracija korisnika</h4>
  <button class="btn btn-primary" (click)="openAddUserModal()">
    <i class="bi bi-plus-circle"></i> Dodaj novog korisnika
  </button>
</div>

<div class="mb-3">
  <input 
    type="text" 
    class="form-control" 
    placeholder="Pretraži po imenu..."
    [(ngModel)]="searchTerm"
    (input)="onSearchChange()">
</div>

<div *ngIf="filteredUsers; else loadingUsers">
  <table *ngIf="filteredUsers.length > 0; else noUsers" class="table table-striped table-hover">
    <thead>
      <tr>
        <th scope="col">Ime</th>
        <th scope="col">Email</th>
        <th scope="col">Uloga</th>
        <th scope="col">Status</th>
        <th scope="col">Akcije</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let user of filteredUsers">
        <td>{{ user.name }}</td>
        <td>{{ user.email }}</td>
        <td><span class="badge" [ngClass]="user.role === 'admin' ? 'bg-success' : 'bg-secondary'">{{ user.role }}</span></td>
        <td><span class="badge" [ngClass]="user.status === 'unutra' ? 'bg-info' : 'bg-light text-dark'">{{ user.status }}</span></td>
        <td>
          <button class="btn btn-sm btn-danger" (click)="deleteUser(user._id, user.name)">Obriši</button>
        </td>
      </tr>
    </tbody>
  </table>

  <ng-template #noUsers>
    <div class="alert alert-info">Nema korisnika koji odgovaraju pretrazi.</div>
  </ng-template>
</div>

<ng-template #loadingUsers>
    <p>Učitavanje korisnika...</p>
</ng-template>